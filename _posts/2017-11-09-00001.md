---
layout: docs
title:  "Linux 为Android编译Glib"
date:   2017-11-09
categories: Linux Android Glib
enable_mathjax: false
enable_mermaid: false
---
下面进行的试验可能并没有道理，但是我就是想试一试。以玩为主。
<hr>
## 准备Android NDK 然后准备一个脚本
主机内核版本号
```
Linux 4.13.9-300.fc27.x86_64
```
本次实验使用的NDK为**r15c**版本。尝试为 **_API26～API14_** 的各种架构编译Glib。

这个黑暗而且看上去毫无用处还容易出错的脚本就放在[这里](https://github.com/QIU1995NONAME/AndroidBuildHelper)。脚本可以被命名为 _helper_ ，并存放在PATH中。Android程序安装目录先放置在'/tmp/targets'中。

## 复制所有SYSROOT
在空文件夹中执行脚本即可。
```bash
$ mkdir /tmp/blank
$ cd /tmp/blank
$ helper --sys /tmp/targets
```

## 借助Git的力量
使用git对targets文件夹进行备份。
每安装完一个软件，使用git进行提交。如果安装失败则可以借助git进行回滚。
```bash
$ git init
$ git add .
$ git commit -m ......
```

## 安装 libiconv 1.15
```bash
$ helper --sys /tmp/targets
```

## 安装 gettext 0.19.8.1 runtime
这一步貌似只有Android 21+可以通过，以下的缺少search.h文件。
```bash
$ cd gettext-runtime
$ helper --sys /tmp/targets CPPFLAGS=-I$NDK/sysroot/usr/include --enable-shared --disable-libasprintf
```

## 安装 pcre 8.41
禁用CPP支持就好
```bash
$ helper --sys /tmp/targets --enable-shared --disable-cpp
```

## 安装 libffi 3.2.1 ~~ 并转移它的头文件 ~~
```bash
$ helper --sys /tmp/targets --enable-shared
```
~~ 下面这段代码可用来转移头文件。~~
```
$ cd $/tmp/targets
$ for i in $(find . | grep include/ffi.h$) ; do
for> cp $(dirname $i)/* $(realpath $(dirname $i)/../../../include)/ 
for> done
$ cd -
```

## 安装 glib 2.48.2

```bash
$ glib_cv_stack_grows=no \
> glib_cv_uscore=no \
> ac_cv_func_posix_getpwuid_r=no \
> ac_cv_func_posix_getgrgid_r=no \
> helper --sys /tmp/targets \
>   --enable-shared --enable-static --disable-libelf
```

## 统计实际生成的库
实际上，并不是每一个环境都可以顺利生成这些软件。我们可以使用下面的脚本进行统计。
```
$ for i in $(dirname $(find . |grep libiconv));do echo $(realpath $i/../..);done |cut -d / -f 4,5 |uniq |sort
```

### libiconv 1.15
```
android-14/arch-arm
android-14/arch-mips
android-14/arch-x86
android-15/arch-arm
android-15/arch-mips
android-15/arch-x86
android-16/arch-arm
android-16/arch-mips
android-16/arch-x86
android-17/arch-arm
android-17/arch-mips
android-17/arch-x86
android-18/arch-arm
android-18/arch-mips
android-18/arch-x86
android-19/arch-arm
android-19/arch-mips
android-19/arch-x86
android-21/arch-arm
android-21/arch-arm64
android-21/arch-mips
android-21/arch-mips64
android-21/arch-x86
android-21/arch-x86_64
android-22/arch-arm
android-22/arch-arm64
android-22/arch-mips
android-22/arch-mips64
android-22/arch-x86
android-22/arch-x86_64
android-23/arch-arm
android-23/arch-arm64
android-23/arch-mips
android-23/arch-mips64
android-23/arch-x86
android-23/arch-x86_64
android-24/arch-arm
android-24/arch-arm64
android-24/arch-mips
android-24/arch-mips64
android-24/arch-x86
android-24/arch-x86_64
android-26/arch-arm
android-26/arch-arm64
android-26/arch-mips
android-26/arch-mips64
android-26/arch-x86
android-26/arch-x86_64
```

### gettext 0.19.8.1 runtime
```
android-21/arch-arm
android-21/arch-arm64
android-21/arch-mips
android-21/arch-mips64
android-21/arch-x86
android-21/arch-x86_64
android-22/arch-arm
android-22/arch-arm64
android-22/arch-mips
android-22/arch-mips64
android-22/arch-x86
android-22/arch-x86_64
android-23/arch-arm
android-23/arch-arm64
android-23/arch-mips
android-23/arch-mips64
android-23/arch-x86
android-23/arch-x86_64
android-24/arch-arm
android-24/arch-arm64
android-24/arch-mips
android-24/arch-mips64
android-24/arch-x86
android-24/arch-x86_64
android-26/arch-arm
android-26/arch-arm64
android-26/arch-mips
android-26/arch-mips64
android-26/arch-x86
android-26/arch-x86_64
```

### pcre 8.41 without cpp
```
android-14/arch-arm
android-14/arch-mips
android-14/arch-x86
android-15/arch-arm
android-15/arch-mips
android-15/arch-x86
android-16/arch-arm
android-16/arch-mips
android-16/arch-x86
android-17/arch-arm
android-17/arch-mips
android-17/arch-x86
android-18/arch-arm
android-18/arch-mips
android-18/arch-x86
android-19/arch-arm
android-19/arch-mips
android-19/arch-x86
android-21/arch-arm
android-21/arch-arm64
android-21/arch-mips
android-21/arch-mips64
android-21/arch-x86
android-21/arch-x86_64
android-22/arch-arm
android-22/arch-arm64
android-22/arch-mips
android-22/arch-mips64
android-22/arch-x86
android-22/arch-x86_64
android-23/arch-arm
android-23/arch-arm64
android-23/arch-mips
android-23/arch-mips64
android-23/arch-x86
android-23/arch-x86_64
android-24/arch-arm
android-24/arch-arm64
android-24/arch-mips
android-24/arch-mips64
android-24/arch-x86
android-24/arch-x86_64
android-26/arch-arm
android-26/arch-arm64
android-26/arch-mips
android-26/arch-mips64
android-26/arch-x86
android-26/arch-x86_64
```

### libffi 3.2.1
```
android-14/arch-arm
android-14/arch-mips
android-14/arch-x86
android-15/arch-arm
android-15/arch-mips
android-15/arch-x86
android-16/arch-arm
android-16/arch-mips
android-16/arch-x86
android-17/arch-arm
android-17/arch-mips
android-17/arch-x86
android-18/arch-arm
android-18/arch-mips
android-18/arch-x86
android-19/arch-arm
android-19/arch-mips
android-19/arch-x86
android-21/arch-arm
android-21/arch-arm64
android-21/arch-mips
android-21/arch-mips64
android-21/arch-x86
android-21/arch-x86_64
android-22/arch-arm
android-22/arch-arm64
android-22/arch-mips
android-22/arch-mips64
android-22/arch-x86
android-22/arch-x86_64
android-23/arch-arm
android-23/arch-arm64
android-23/arch-mips
android-23/arch-mips64
android-23/arch-x86
android-23/arch-x86_64
android-24/arch-arm
android-24/arch-arm64
android-24/arch-mips
android-24/arch-mips64
android-24/arch-x86
android-24/arch-x86_64
android-26/arch-arm
android-26/arch-arm64
android-26/arch-mips
android-26/arch-mips64
android-26/arch-x86
android-26/arch-x86_64
```

### glib 2.48.2
```
android-21/arch-arm
android-21/arch-arm64
android-21/arch-mips
android-21/arch-x86
android-21/arch-x86_64
android-22/arch-arm
android-22/arch-arm64
android-22/arch-mips
android-22/arch-x86
android-22/arch-x86_64
android-23/arch-arm
android-23/arch-arm64
android-23/arch-mips
android-23/arch-x86
android-23/arch-x86_64
android-24/arch-arm
android-24/arch-arm64
android-24/arch-mips
android-24/arch-x86
android-24/arch-x86_64
```



