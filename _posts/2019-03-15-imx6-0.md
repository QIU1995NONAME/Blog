---
layout: docs
title:  "IMX6 踩坑"
date:   2019-03-15
categories: Linux ARM IMX6
enable_mathjax: false
enable_mermaid: false
enable_comments: false
---

## 准备工作
+ [Linux-imx](https://source.codeaurora.org/external/imx/linux-imx.git) imx_4.14.78_1.0.0
+ [u-boot-imx](https://source.codeaurora.org/external/imx/uboot-imx.git) imx_v2018.03_4.14.78_1.0.0_ga
+ arm-unknown-linux-gnueabi-gcc

## 必要软件制作
### 交叉编译器 arm-unknown-linux-gnueabi
使用 [crosstool-ng](https://crosstool-ng.github.io/) 即可制作，此处略。

### U-BOOT-imx imx_v2018.03_4.14.78_1.0.0_ga
``` bash
  ###### 替换其中的命令
$ sed -i "s/fatload/ext4load/g" "include/configs/mx6sabre_common.h"
  ###### 编译 U-BOOT
$ make ARCH=arm CROSS_COMPILE=arm-unknown-linux-gnueabi- mx6qsabresd_defconfig
$ make ARCH=arm CROSS_COMPILE=arm-unknown-linux-gnueabi- -j16
  ###### 烧录 U-BOOT 到 SD 卡
$ sudo dd if=u-boot-dtb.imx of=/dev/sdX bs=1K seek=1
```

### Linux-imx imx_4.14.78_1.0.0

``` bash
$ vim arch/arm/boot/dts/imx6qdl-sabresd.dtsi
  ###### 搜索 usdhc，将带有 wp-gpios 的行注释掉，屏蔽掉 SD 卡的写入保护。
$ make ARCH=arm CROSS_COMPILE=arm-unknown-linux-gnueabi- imx_v7_defconfig
  ###### 修改部分配置
$ cat >> .config << __EOF__
# COMMON
CONFIG_MODULES=nCONFIG_KERNEL_GZIP=y
CONFIG_PREEMPT_NONE=y
# IO
CONFIG_INPUT_MOUSE=n
CONFIG_SOUND=n
# NET
CONFIG_IPV6=n
CONFIG_NETFILTER=n
CONFIG_BT=n
CONFIG_USB_NET_DRIVERS=n
CONFIG_WLAN=n
CONFIG_PPP=n
__EOF__

$ make ARCH=arm CROSS_COMPILE=arm-unknown-linux-gnueabi- menuconfig
$ make ARCH=arm CROSS_COMPILE=arm-unknown-linux-gnueabi- -j16 dtbs
$ make ARCH=arm CROSS_COMPILE=arm-unknown-linux-gnueabi- -j16
$ make ARCH=arm CROSS_COMPILE=arm-unknown-linux-gnueabi- \
        INSTALL_PATH=/tmp/$(date +%Y%m%d-%H%M%S)/ dtbs_install zinstall

```
